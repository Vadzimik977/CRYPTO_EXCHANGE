{% extends 'main/base_generic.html' %}

{% block title %}–£—Å–ø–µ—à–Ω–æ{% endblock %}

{% block content %}
<div class="card text-white bg-success mb-3" style="max-width: 40rem;">
  <div class="card-header">–£—Å–ø–µ—à–Ω–æ!</div>
  <div class="card-body">
<div class="container">
    <div class="text-center">
        <h1 class="mt-4">–í–∞—à –∑–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω!</h1>
        <h4 class="mt-4">–°–ø–∞—Å–∏–±–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞—à–µ–≥–æ –æ–±–º–µ–Ω–Ω–∏–∫–∞.</h4>
    </div>

    <div class="text-center">
        <h2>–û—Å—Ç–∞–≤—å—Ç–µ –æ—Ç–∑—ã–≤ –æ –∑–∞–∫–∞–∑–µ</h2>
        <form method="post" class="mt-4">
            {% csrf_token %}
            <div class="btn-group btn-group-lg" role="group">
                <button type="button" class="btn btn-sm btn-primary smiley" data-value="1">üò¢</button>
                <button type="button" class="btn btn-sm btn-primary smiley" data-value="2">üòû</button>
                <button type="button" class="btn btn-sm btn-primary smiley" data-value="3">üòê</button>
                <button type="button" class="btn btn-sm btn-primary smiley" data-value="4">üòä</button>
                <button type="button" class="btn btn-sm btn-primary smiley" data-value="5">üòÑ</button>
            </div>
            <div class="form-group mt-3">

                 <textarea class="form-control" rows="4" id="id_text" name="text" >{{ comment_form.text.value }}</textarea>
            </div>
            <input type="hidden" id="rating-input" name="rating" value="0">
            <button class="btn btn-primary btn-lg" type="submit" id="review-submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
        </form>
    </div>

<!--    <div class="text-center mt-4">-->
<!--        <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ</h2>-->
<!--        <p>Order ID: {{ order.order_id }}</p>-->
<!--        &lt;!&ndash; –î—Ä—É–≥–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ &ndash;&gt;-->
<!--    </div>-->
</div>
</div>
</div>

<script>
    // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ URL (–Ω–∞–ø—Ä–∏–º–µ—Ä, order_id, amount, crypto_currency)
    var urlParams = new URLSearchParams(window.location.search);
    var order_id = urlParams.get('order_id');

    // –û—Ç–ø—Ä–∞–≤–∫–∞ AJAX-–∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    $.ajax({
        type: "GET",
        url: "/check_order_status/?order_id=" + order_id,
        data: { order_id: order_id },
        success: function(response) {
            // –í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ –Ω—É–∂–Ω–æ–µ –º–µ—Å—Ç–æ
            $('#content').html(response);
        },
        error: function(error) {
            console.log("–û—à–∏–±–∫–∞ AJAX-–∑–∞–ø—Ä–æ—Å–∞:", error);
        }
    });

    $('.smiley').click(function() {
        $('.smiley').removeClass('btn-secondary');
        $('.smiley').removeClass('selected');

        var rating = $(this).attr('data-value');
        $('#rating-input').val(rating);
        $(this).addClass('selected btn-secondary');
    });

    $(document).ready(function() {
    $('#review-submit').on('click', function() {
        var csrfToken = $('input[name=csrfmiddlewaretoken]').val();
        var text = $('#id_text').val();
        var order_id = '{{ order.order_id }}'; // –ó–Ω–∞—á–µ–Ω–∏–µ order_id, –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ –∏–∑ —Å–µ—Ä–≤–µ—Ä–∞

        var rating = $('#rating-input').val(); // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏ —Å–º–∞–π–ª–∏–∫–æ–º

        $.ajax({
            type: "POST",
            url: "{% url 'reviews' %}",
            data: {
                'csrfmiddlewaretoken': csrfToken,
                'text': text,
                'order_id': order_id,
                'rating': rating, // –ü–µ—Ä–µ–¥–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏
            },
            success: function(response) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–∑—ã–≤—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ reviews
                $('#reviews').html(response);
                alert('–û—Ç–∑—ã–≤ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
            },
            error: function(error) {
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç–∑—ã–≤–∞');
            }
        });
    });
});

</script>
{% endblock %}